<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><title>Exercises - VNAV2020</title><link rel="shortcut icon" href="https://mit-spark.github.io/VNAV2020-handouts/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="https://mit-spark.github.io/VNAV2020-handouts/assets/css/just-the-docs.css"> <script src="https://use.fontawesome.com/d81b2d50d8.js"></script> <script type="text/javascript" src="https://mit-spark.github.io/VNAV2020-handouts/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="https://mit-spark.github.io/VNAV2020-handouts/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Exercises | VNAV2020</title><meta name="generator" content="Jekyll v3.8.6" /><meta property="og:title" content="Exercises" /><meta property="og:locale" content="en_US" /><meta name="description" content="16.485 - Visual Navigation for Autonomous Vehicles (2020)" /><meta property="og:description" content="16.485 - Visual Navigation for Autonomous Vehicles (2020)" /><link rel="canonical" href="https://mit-spark.github.io/VNAV2020-handouts/lab2/exercises" /><meta property="og:url" content="https://mit-spark.github.io/VNAV2020-handouts/lab2/exercises" /><meta property="og:site_name" content="VNAV2020" /> <script type="application/ld+json"> {"@type":"WebPage","headline":"Exercises","url":"https://mit-spark.github.io/VNAV2020-handouts/lab2/exercises","description":"16.485 - Visual Navigation for Autonomous Vehicles (2020)","@context":"https://schema.org"}</script> <script> window.MathJax = { options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'], }, loader: { load: ['input/tex', '[tex]/ams', '[tex]/configMacros'] }, tex: { packages: {'[+]': ['boldsymbol', 'ams', 'configMacros']}, inlineMath: [['$','$'], ['\\(','\\)']], displayMath: [["$$", "$$"], ["\\[","\\]"]], processEscapes: true, tags: "ams", macros: { SE: ['\\mathrm{SE}(#1)', 1], SO: ['\\mathrm{SO}(#1)', 1], argmin: '\\mathop{\\operatorname{argmin}}', argmax: '\\mathop{\\operatorname{argmax}}', trace: '\\operatorname{trace}', tran: '^{\\mathsf{T}}', }, }, }; </script> <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" async></script> <script type="text/javascript" src="https://mit-spark.github.io/VNAV2020-handouts/assets/js/vendor/lazysizes.min.js" async=""></script><body><div class="page-wrap">
<div class="side-bar">
<div class="site-header"> <a href="https://mit-spark.github.io/VNAV2020-handouts/" class="site-title lh-tight">VNAV2020</a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button>
</div>
<div class="navigation main-nav js-main-nav"><nav role="navigation" aria-label="Main navigation"><ul class="navigation-list">
<li class="navigation-list-item"><a href="https://mit-spark.github.io/VNAV2020-handouts/" class="navigation-list-link">Home</a></li>
<li class="navigation-list-item">
<a href="https://mit-spark.github.io/VNAV2020-handouts/lab1/" class="navigation-list-link">Lab 1</a><ul class="navigation-list-child-list ">
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab1/ubuntu" class="navigation-list-link">Install Ubuntu 18.04</a></li>
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab1/shell" class="navigation-list-link">Shell basics</a></li>
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab1/git" class="navigation-list-link">Git</a></li>
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab1/cpp" class="navigation-list-link">C++</a></li>
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab1/exercises" class="navigation-list-link">Exercises</a></li>
</ul>
</li>
<li class="navigation-list-item active">
<a href="https://mit-spark.github.io/VNAV2020-handouts/lab2/" class="navigation-list-link">Lab 2</a><ul class="navigation-list-child-list ">
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab2/ros" class="navigation-list-link">Installing ROS</a></li>
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab2/ros101" class="navigation-list-link">Introduction to ROS</a></li>
<li class="navigation-list-item active"><a href="https://mit-spark.github.io/VNAV2020-handouts/lab2/exercises" class="navigation-list-link active">Exercises</a></li>
</ul>
</li>
<li class="navigation-list-item">
<a href="https://mit-spark.github.io/VNAV2020-handouts/lab3/" class="navigation-list-link">Lab 3</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab3/exercises" class="navigation-list-link">Exercises</a></li></ul>
</li>
<li class="navigation-list-item">
<a href="https://mit-spark.github.io/VNAV2020-handouts/lab4/" class="navigation-list-link">Lab 4</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab4/exercises" class="navigation-list-link">Exercises</a></li></ul>
</li>
<li class="navigation-list-item">
<a href="https://mit-spark.github.io/VNAV2020-handouts/lab5/" class="navigation-list-link">Lab 5</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab5/exercises" class="navigation-list-link">Exercises</a></li></ul>
</li>
<li class="navigation-list-item">
<a href="https://mit-spark.github.io/VNAV2020-handouts/lab6/" class="navigation-list-link">Lab 6</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab6/exercises" class="navigation-list-link">Exercises</a></li></ul>
</li>
<li class="navigation-list-item">
<a href="https://mit-spark.github.io/VNAV2020-handouts/lab7/" class="navigation-list-link">Lab 7</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab7/exercises" class="navigation-list-link">Exercises</a></li></ul>
</li>
<li class="navigation-list-item">
<a href="https://mit-spark.github.io/VNAV2020-handouts/lab8/" class="navigation-list-link">Lab 8</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab8/exercises" class="navigation-list-link">Exercises</a></li></ul>
</li>
<li class="navigation-list-item">
<a href="https://mit-spark.github.io/VNAV2020-handouts/lab9/" class="navigation-list-link">Lab 9</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab9/exercises" class="navigation-list-link">Exercises</a></li></ul>
</li>
<li class="navigation-list-item"><a href="https://mit-spark.github.io/VNAV2020-handouts/about" class="navigation-list-link">How to print</a></li>
</ul></nav></div>
<footer class="site-footer"><p class="text-small text-grey-dk-000 mb-4"><b>Last modified</b>:<br> Monday, November 2 at 17:52</p></footer>
</div>
<div class="main-content-wrap js-main-content" tabindex="0"><div class="main-content">
<div class="page-header js-page-header"><div class="search">
<div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search VNAV2020" aria-label="Search VNAV2020" autocomplete="off"> <svg width="14" height="14" viewbox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title>
<g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"></path><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"></path></g></svg>
</div>
<div class="js-search-results search-results-wrap"></div>
</div></div>
<div class="page">
<nav class="breadcrumb-nav"><ol class="breadcrumb-nav-list">
<li class="breadcrumb-nav-list-item"><a href="https://mit-spark.github.io/VNAV2020-handouts/lab2/">Lab 2</a></li>
<li class="breadcrumb-nav-list-item"><span>Exercises</span></li>
</ol></nav><div id="main-content" class="page-content" role="main">
<h1 class="no_toc text-delta fs-9" id="exercises"> <a href="#exercises" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Exercises</h1>
<ol id="markdown-toc">
<li>
<a href="#submission" id="markdown-toc-submission">Submission</a><ol><li><a href="#find-a-team" id="markdown-toc-find-a-team">Find a team</a></li></ol>
</li>
<li>
<a href="#setup-workspace" id="markdown-toc-setup-workspace">Setup workspace</a><ol>
<li><a href="#create-the-catkin-workspace" id="markdown-toc-create-the-catkin-workspace">Create the catkin workspace</a></li>
<li><a href="#getting-the-lab-code" id="markdown-toc-getting-the-lab-code">Getting the Lab code</a></li>
<li><a href="#building-the-code" id="markdown-toc-building-the-code">Building the code</a></li>
<li>
<a href="#a-two-drone-scenario" id="markdown-toc-a-two-drone-scenario">A two-drone scenario</a><ol><li><a href="#the-static-scenario-and-rviz" id="markdown-toc-the-static-scenario-and-rviz">The static scenario and rViz</a></li></ol>
</li>
</ol>
</li>
<li>
<a href="#problem-formulation" id="markdown-toc-problem-formulation">Problem formulation</a><ol>
<li><a href="#positions" id="markdown-toc-positions">Positions</a></li>
<li><a href="#orientations" id="markdown-toc-orientations">Orientations</a></li>
</ol>
</li>
<li>
<a href="#basic-ros-commands" id="markdown-toc-basic-ros-commands">Basic ROS commands</a><ol><li><a href="#-deliverable-1---nodes-topics-launch-files-10-pts" id="markdown-toc--deliverable-1---nodes-topics-launch-files-10-pts">📨 Deliverable 1 - Nodes, topics, launch files (10 pts)</a></li></ol>
</li>
<li>
<a href="#lets-make-things-move-publishing-the-transforms-using-tf" id="markdown-toc-lets-make-things-move-publishing-the-transforms-using-tf">Let’s make things move! Publishing the transforms using tf</a><ol>
<li><a href="#some-context" id="markdown-toc-some-context">Some Context</a></li>
<li>
<a href="#-deliverable-2---publishing-transforms-30-pts" id="markdown-toc--deliverable-2---publishing-transforms-30-pts">📨 Deliverable 2 - Publishing transforms (30 pts)</a><ol>
<li><a href="#how-to-test" id="markdown-toc-how-to-test">How to test</a></li>
<li><a href="#what-to-expect" id="markdown-toc-what-to-expect">What to expect</a></li>
</ol>
</li>
<li><a href="#changing-the-rviz-fixed-reference-frame" id="markdown-toc-changing-the-rviz-fixed-reference-frame">Changing the rViz fixed reference frame.</a></li>
<li>
<a href="#-deliverable-3---looking-up-a-transform-30-pts" id="markdown-toc--deliverable-3---looking-up-a-transform-30-pts">📨 Deliverable 3 - Looking up a transform (30 pts)</a><ol><li><a href="#what-to-expect-1" id="markdown-toc-what-to-expect-1">What to expect</a></li></ol>
</li>
</ol>
</li>
<li>
<a href="#lets-do-some-math" id="markdown-toc-lets-do-some-math">Let’s do some math</a><ol>
<li><a href="#-deliverable-4---mathematical-derivations-25-pts" id="markdown-toc--deliverable-4---mathematical-derivations-25-pts">📨 Deliverable 4 - Mathematical derivations (25 pts)</a></li>
<li><a href="#-deliverable-5---more-properties-of-quaternions-5-pts" id="markdown-toc--deliverable-5---more-properties-of-quaternions-5-pts">📨 Deliverable 5 - More properties of quaternions (5 pts)</a></li>
<li><a href="#-optional-deliverable-6---intrinsic-vs-extrinsic-rotations-20-pts" id="markdown-toc--optional-deliverable-6---intrinsic-vs-extrinsic-rotations-20-pts">📨 [Optional] Deliverable 6 - Intrinsic vs Extrinsic rotations (20 pts)</a></li>
</ol>
</li>
</ol>
<h2 id="submission"> <a href="#submission" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Submission</h2>
<p>To submit your solutions create a folder called <code class="highlighter-rouge">lab2</code> and push one or more file to your repository with your answers (it can be plain text, markdown, pdf or whatever other format is reasonably easy to read)</p>
<ul>
<li>for <strong>math-related</strong> deliverables, LaTeX is preferred but handwritten is accepted too</li>
<li>for <strong>code-based</strong> deliverables, push the source code of the entire package</li>
</ul>
<p><strong>Deadline:</strong> the VNAV staff will clone your repository on <strong>Wednesday 16th</strong> at midnight EDT.</p>
<h3 id="find-a-team"> <a href="#find-a-team" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Find a team</h3>
<p>Next lab will have a team section, you should start thinking about your team!</p>
<div class="alert alert-info"><div class="alert-content">
<h2 class="alert-title"> Find a team.</h2>
<div class="alert-body"><p> Please find your team members, fill out this <a href="https://docs.google.com/spreadsheets/d/1Mzy48yELRTpwzNxv4nCpims9kL3TsNBiMRgnQo3r830/edit?usp=sharing" target="_blank" rel="noopener noreferrer">spreadsheet</a>.</p></div>
</div></div>
<p>Please fill it before <strong>Wednesday 16th</strong>.</p>
<h2 id="setup-workspace"> <a href="#setup-workspace" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Setup workspace</h2>
<h3 id="create-the-catkin-workspace"> <a href="#create-the-catkin-workspace" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Create the catkin workspace</h3>
<p>To get started, we must create a ROS workspace for the VNAV class. Choose your favorite working directory, we will assume you are creating one in your home directory (i.e <code class="highlighter-rouge">~/</code>). In a terminal, run:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mkdir</span> <span class="nt">-p</span> ~/vnav_ws/src
<span class="nv">$ </span><span class="nb">cd</span> ~/vnav_ws/
<span class="nv">$ </span>catkin init
Initializing catkin workspace <span class="k">in</span> <span class="sb">`</span>/home/antonap/vnav_ws<span class="sb">`</span><span class="nb">.</span>
<span class="nt">--------------------------------------------------------------</span>
Profile:                     default
Extending:             <span class="o">[</span><span class="nb">env</span><span class="o">]</span> /opt/ros/melodic
Workspace:                   /home/antonap/vnav_ws
<span class="nt">--------------------------------------------------------------</span>
Build Space:       <span class="o">[</span>missing] /home/antonap/vnav_ws/build
Devel Space:       <span class="o">[</span>missing] /home/antonap/vnav_ws/devel
Install Space:      <span class="o">[</span>unused] /home/antonap/vnav_ws/install
Log Space:         <span class="o">[</span>missing] /home/antonap/vnav_ws/logs
Source Space:       <span class="o">[</span>exists] /home/antonap/vnav_ws/src
DESTDIR:            <span class="o">[</span>unused] None
<span class="nt">--------------------------------------------------------------</span>
Devel Space Layout:          linked
Install Space Layout:        None
<span class="nt">--------------------------------------------------------------</span>
Additional CMake Args:       None
Additional Make Args:        None
Additional catkin Make Args: None
Internal Make Job Server:    True
Cache Job Environments:      False
<span class="nt">--------------------------------------------------------------</span>
Whitelisted Packages:        None
Blacklisted Packages:        None
<span class="nt">--------------------------------------------------------------</span>
Workspace configuration appears valid.
<span class="nt">--------------------------------------------------------------</span>
</code></pre></div></div>
<h3 id="getting-the-lab-code"> <a href="#getting-the-lab-code" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Getting the Lab code</h3>
<p>Go the folder where you cloned the Labs codebase and run <code class="highlighter-rouge">git pull</code>. This command will update the folder with the latest code. Let’s suppose we have the codebase in <code class="highlighter-rouge">~/labs</code>. In <code class="highlighter-rouge">~/labs/lab2</code> you now have the <code class="highlighter-rouge">two_drones_pkg</code> folder, which is a ROS package. Copy this folder in your VNAV workspace and build the workspace as follows:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> <span class="nt">-r</span> ~/labs/lab2/two_drones_pkg ~/vnav_ws/src
</code></pre></div></div>
<h3 id="building-the-code"> <a href="#building-the-code" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Building the code</h3>
<p>Building the code is as easy as running:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>catkin build
</code></pre></div></div>
<p>Now that you built the code you see that catkin added a bunch of new folders. In order to use our workspace, we need to make ROS aware of all the components by sourcing the corresponding environment. This is done by running the following in <strong>every single terminal</strong> where you intend to use the workspace:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source </span>devel/setup.bash
</code></pre></div></div>
<p>For the rest of the assignment, we assume that you are performing this operation whenever necessary.</p>
<h3 id="a-two-drone-scenario"> <a href="#a-two-drone-scenario" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> A two-drone scenario</h3>
<p>In this part, we are going to work with 3D Rigid Transformations and with tf, a basic tool provided by ROS to keep track of multiple coordinate frames over time.</p>
<h4 id="the-static-scenario-and-rviz"> <a href="#the-static-scenario-and-rviz" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> The static scenario and rViz</h4>
<p>To get started, let’s go back to the VNAV workspace and bring up the two-drones static scenario. In this environment, we have two aerial vehicles, AV1 [blue] and AV2 [red] that are not moving, but it serves as a good starting point! With the VNAV workspace sourced in a terminal, run:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch two_drones_pkg two_drones.launch static:<span class="o">=</span>True
</code></pre></div></div>
<p>You should see the following window, which shows the initial positions of the two AVs.</p>
<p><img src="/VNAV2020-handouts/assets/images/lab2/rViz.png" alt="rViz" class="mx-auto d-block"></p>
<p>This window is <a href="http://wiki.ros.org/rviz" target="_blank" rel="noopener noreferrer">rViz</a>, the mighty ROS visualizer! Just like most processes in the ROS ecosystem, rViz is a ROS node. Like all other nodes, rViz can subscribe to ROS topics. However, its specialty is converting them into graphics on your screen to display the state of your robotic system.</p>
<p>As a first experience with rViz, let us:</p>
<ul>
<li>Add the visualization of <code class="highlighter-rouge">\tf</code>. In the Displays panel, click Add, select the By display type Tab in the pop-up and finally select “TF” and confirm with Ok. You should see all the reference frames, with names and their axes represented in red (x), green (y) and blue (z).</li>
<li>Save the configuration file. So that we don’t have to repeat the step above every time we launch it! Hit <kbd>CTRL</kbd> + <kbd>s</kbd> or select <em>File</em> &gt; <em>Save Config</em>.</li>
</ul>
<p>Other published topics can be added to the visualizer in a similar way.</p>
<h2 id="problem-formulation"> <a href="#problem-formulation" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Problem formulation</h2>
<p>We consider the scenario illustrated in the picture below, where two aerial vehicles, AV1 [blue] and AV2 [red] are following different trajectories: a <strong>circle</strong> and an <strong>arc of parabola</strong>, respectively. In the scene, we have highlighted the following elements:</p>
<ul>
<li>The world frame $(x_w, y_w, z_w)$</li>
<li>The AV1 body frame, centered in $O_1$ with axes $(x_1,y_1,z_1)$</li>
<li>The origin of AV2, denoted with $O_2$</li>
</ul>
<p><img src="/VNAV2020-handouts/assets/images/lab2/two-drones-refs.png" alt="Two drones reference systems" class="mx-auto d-block img-size-60"></p>
<h4 id="positions"> <a href="#positions" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Positions</h4>
<p>In the world frame, AV1 and AV2’s origins are given by:</p>
<ul>
<li>$o_1^w = [\text{cos}(t), \text{sin}(t), 0]^T$, and</li>
<li>$o_2^w = [\text{sin}(t), 0, \text{cos}(2t)]^T$,</li>
</ul>
<p>where $t$ denotes time.</p>
<h4 id="orientations"> <a href="#orientations" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Orientations</h4>
<p>We will make the following simplifying assumptions:</p>
<ul>
<li>AV1’s reference frame is such that $y_1$ stays tangent to AV1’s trajectory for all $t$ and $z_1$ is parallel to $z_w$ for all $t$ (i.e., equivalently, roll = pitch = 0, yaw = $t$)</li>
<li>AV2’s reference frame moves with pure translation and we can assume that its axes are parallel to the world axes for all times $t$</li>
</ul>
<blockquote>
<p><strong>Notes</strong></p>
<ul>
<li>Given the dynamics of a quadrotor, these motions are dynamically infeasible. However, for the purpose of this lab, we disregard this fact and focus on the study of rigid transformations</li>
<li>To make the math of this problem more interesting, we chose the $y_1$ axis to point in the direction of motion of the drone. However, do not forget that the standard convention is that $x_1$ should point forward!</li>
</ul>
</blockquote>
<p>In the sequel, we reproduce the above scenario in ROS and study the trajectory of AV2 relative to AV1’s coordinate frame.</p>
<h2 id="basic-ros-commands"> <a href="#basic-ros-commands" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Basic ROS commands</h2>
<h3 id="-deliverable-1---nodes-topics-launch-files-10-pts"> <a href="#-deliverable-1---nodes-topics-launch-files-10-pts" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 📨 Deliverable 1 - Nodes, topics, launch files (10 pts)</h3>
<p>With the <code class="highlighter-rouge">roslaunch</code> command above we have spawned a number of ROS nodes at the same time. Using your knowledge of ROS, answer the following questions:</p>
<ol>
<li>List the nodes running in the two-drone static scenario.<ul><li class="hint">Hint: you can directly inspect the launch file or get some help from <code class="highlighter-rouge">rqt_graph</code>. You will notice that rViz is initially not shown in it but you can uncheck the <em>Debug</em> option for a full picture, feel free to ignore all <code class="highlighter-rouge">/rosout</code> nodes and topics and <code class="highlighter-rouge">/rqt_gui_py_*</code> that may appear</li></ul>
</li>
<li>How could you run the two-drone static scenario without using the roslaunch command? List the commands that you would have to execute, in separate terminals, to achieve the same result.<ul><li class="hint">Hint: <code class="highlighter-rouge">rosrun [...]</code>, try things out before finalizing your answer!</li></ul>
</li>
<li>List the topics that each node publishes / subscribes to. What nodes are responsible for publishing the av1, av2, frames? Which topic causes rViz to plot the drone meshes?<ul><li class="hint">Hint: uncheck items on the left pane in rViz until the meshes disappear, then check what node is publishing the corresponding topic</li></ul>
</li>
<li>What changes if we omit <code class="highlighter-rouge">static:=True</code>? Why?<ul><li class="hint">Hint: check out and briefly explain the if and unless keywords in the launch file</li></ul>
</li>
</ol>
<h2 id="lets-make-things-move-publishing-the-transforms-using-tf"> <a href="#lets-make-things-move-publishing-the-transforms-using-tf" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Let’s make things move! Publishing the transforms using tf</h2>
<p>After exploring the static scenario, it’s time to implement the motions described in the <a href="#problem-formulation">problem formulation</a> section and visualize them in rViz. With the editor of your choice, open <code class="highlighter-rouge">frames_publisher_node.cpp</code> in the <code class="highlighter-rouge">src</code> folder of <code class="highlighter-rouge">two_drones_pkg</code>. In this file, we provide a basic structure of a ROS node.</p>
<h3 id="some-context"> <a href="#some-context" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Some Context</h3>
<p>Please take your time to familiarize with this code before modifying it. Although not mandatory, the pattern found in it is a very common way to implement ROS nodes:</p>
<ul>
<li>The node’s source code is encapsulated into a class, <code class="highlighter-rouge">FramesPublisherNode</code> (line 6), which keeps a nodeHandle as a private member.</li>
<li>In the constructor of the class (lines 14 to 19), one performs operations that need to be executed only once upon startup (e.g. typically, initializing subscribers and publishers),</li>
<li>Using a Timer (lines 10 and 17), the <code class="highlighter-rouge">onPublish()</code> method is called periodically - at a 50Hz - and all the operations within it are performed ad libitum,</li>
<li>In the body of <code class="highlighter-rouge">main()</code> (towards the end of the file):<ul>
<li>the node is registered with <code class="highlighter-rouge">ros::init(...)</code>
</li>
<li>an instance of the node class is created</li>
<li>a blocking call to <code class="highlighter-rouge">ros::spin()</code> is issued, which starts ROS’s main loop.</li>
</ul>
</li>
</ul>
<h3 id="-deliverable-2---publishing-transforms-30-pts"> <a href="#-deliverable-2---publishing-transforms-30-pts" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 📨 Deliverable 2 - Publishing transforms (30 pts)</h3>
<p>In <code class="highlighter-rouge">frames_publisher_node.cpp</code>, follow the instructions in the comments and fill in the missing code. Your objective is to populate the provided <code class="highlighter-rouge">AV1World</code> and <code class="highlighter-rouge">AV2World</code> variables to match the motions described in the problem formulation. These objects are instances of the <code class="highlighter-rouge">tf::transform</code> class, which is ROS jargon for a homogeneous transformation matrix.</p>
<div class="alert alert-warning"><div class="alert-content">
<h2 class="alert-title"> Keep in mind.</h2>
<div class="alert-body"><p> Ensure that the orientation of the AV1 frame is in accordance with the assumptions made in the problem formulation, as this is of crucial importance for the final result!</p></div>
</div></div>
<h4 id="how-to-test"> <a href="#how-to-test" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> How to test</h4>
<p>Once you are ready to compile your code, run:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>catkin build
</code></pre></div></div>
<p>from the workspace folder <code class="highlighter-rouge">~/vnav_ws</code>.</p>
<p>To try out your code, launch the two-drone scenario in non-static mode, i.e. run:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch two_drones_pkg two_drones.launch
</code></pre></div></div>
<h4 id="what-to-expect"> <a href="#what-to-expect" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> What to expect</h4>
<p>You should finally see the drones moving! Check that the trajectories reflect those illustrated in the figure in the problem formulation.</p>
<p><img src="https://mit-spark.github.io/VNAV2020-handouts/assets/images/lab2/two_drones_rviz.gif" alt="Two drones example" class="mx-auto d-block"></p>
<h3 id="changing-the-rviz-fixed-reference-frame"> <a href="#changing-the-rviz-fixed-reference-frame" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Changing the rViz fixed reference frame.</h3>
<p>As mentioned, we are interested in the motion of AV2 relative to AV1’s reference frame. In the Displays panel (left, by default), under the Global Options section, rViz offers the possibility to change the Fixed Frame to any frame published in tf. Try it out yourself and change “world” into “av1” by typing in the corresponding field. From this perspective, AV1 appears static, the world frame spins around its $z$ axis and AV2 seems to be following a closed-curve trajectory.</p>
<h3 id="-deliverable-3---looking-up-a-transform-30-pts"> <a href="#-deliverable-3---looking-up-a-transform-30-pts" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 📨 Deliverable 3 - Looking up a transform (30 pts)</h3>
<p>In <code class="highlighter-rouge">plots_publisher_node.cpp</code>, follow the instructions in the comments and fill in the missing code. Your objective is to populate the provided object, transform, with the relative transform between two given frames with names <code class="highlighter-rouge">ref_frame</code> and <code class="highlighter-rouge">dest_frame</code>.</p>
<p>Compile your code and try it out as previously explained.</p>
<h4 id="what-to-expect-1"> <a href="#what-to-expect-1" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> What to expect</h4>
<p>You should eventually see three trajectories, namely:</p>
<ul>
<li>AV1’s trajectory [blue, solid] in the world frame (circle on the x-y plane)</li>
<li>AV2’s trajectory [red, solid] in the world frame (parabola on the z-x plane)</li>
<li>The trajectory of AV2 in AV1’s frame [red, dashed]. You should now have a strong hunch that this curve is a ellipse on a “slanted” plane!</li>
</ul>
<p><strong>Note</strong>: if the results you are observing do not seem to make sense, try swapping <code class="highlighter-rouge">ref_frame</code> and <code class="highlighter-rouge">dest_frame</code> when interrogating <code class="highlighter-rouge">\tf</code>.</p>
<h2 id="lets-do-some-math"> <a href="#lets-do-some-math" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Let’s do some math</h2>
<p>So far, we have used ROS and tf to get a visual understanding of the motion of AV2 relative to AV1’s body frame. In this section, you are asked to use your knowledge about homogeneous transformations and study the relative trajectory explicitly.</p>
<p>The visualization we have built should provide you with great guidance while working out the following questions. Since this exercise is designed for you to familiarize with the math of 3D transformations, we require that you explicitly write down all the homogeneous transformation matrices used in the process and precisely outline the logic and algebraic steps taken.</p>
<h3 id="-deliverable-4---mathematical-derivations-25-pts"> <a href="#-deliverable-4---mathematical-derivations-25-pts" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 📨 Deliverable 4 - Mathematical derivations (25 pts)</h3>
<ol>
<li>In the <a href="#problem-formulation">problem formulation</a>, we mentioned that AV2’s trajectory is an arc of parabola in the $x$-$z$ plane of the world frame. Can you prove this statement?<ul><li class="hint">Hint: $cos(2t)$ can be written as…</li></ul>
</li>
<li>Compute $o_2^1(t)$, i.e., the position of AV2 relative to AV1’s body frame as a function of $t$.<ul><li class="hint">Hint: write down the homogeneous transformations and compose them accordingly…</li></ul>
</li>
<li>Show that $o_2^1(t)$ describes a planar curve and find the equation of its plane $\Pi$.<ul><li class="hint">Hint: find a linear relation between $z_2^1$ and $y_2^1$</li></ul>
</li>
<li>Rewrite the above trajectory explicitly using a 2D frame of reference $(x_p, y_p)$ on the plane found before. Try to ensure that the curve is centered at the origin of this 2D frame and that $x_p$, $y_p$ are axes of symmetry for the curve.<ul><li class="hint">Hints:</li></ul>
<ol>
<li class="hint"> i) center the new 2D frame in $p^1= (-1,-1/2,0)$, these coordinates are in AV1’s frame</li>
<li class="hint"> ii) start with a 3D reference frame centered in p with axes $(x_p, y_p, z_p)$, compute $o_2^p(t)$</li>
<li class="hint"> iii) make sure that the $z$ component vanishes after the change of coordinates</li>
</ol>
</li>
<li>Using the expression of $o_2^p(t)$, prove that the trajectory of AV2 relative to AV1 is an ellipse and compute the lengths of its semi-axes.<ul><li class="hint">Hint: what is the general form of the equation of an axis-aligned ellipse centered in the origin?</li></ul>
</li>
</ol>
<h3 id="-deliverable-5---more-properties-of-quaternions-5-pts"> <a href="#-deliverable-5---more-properties-of-quaternions-5-pts" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 📨 Deliverable 5 - More properties of quaternions (5 pts)</h3>
<p>In the lecture notes, we have defined two linear maps $\Omega_1: \mathbb{R}^4 \rightarrow \mathbb{R}^{4\times 4}$, and $\Omega_2: \mathbb{R}^4 \rightarrow \mathbb{R}^{4\times 4}$, such that for any $q \in \mathbb{R}^4$, we have: \[ \Omega_1(q) = \begin{bmatrix} q_4 &amp; -q_3 &amp; q_2 &amp; q_1 \\ q_3 &amp; q_4 &amp; -q_1 &amp; q_2 \\ -q_2 &amp; q_1 &amp; q_4 &amp; q_3 \\ -q_1 &amp; -q_2 &amp; -q_3 &amp; q_4 \end{bmatrix}, \Omega_2(q) = \begin{bmatrix} q_4 &amp; q_3 &amp; -q_2 &amp; q_1 \\ -q_3 &amp; q_4 &amp; q_1 &amp; q_2 \\ q_2 &amp; -q_1 &amp; q_4 &amp; q_3 \\ -q_1 &amp; -q_2 &amp; -q_3 &amp; q_4 \end{bmatrix}. \] The product between any two unit quaternions can then be explicitly computed as: \[ q_a \otimes q_b = \Omega_1(q_a) q_b = \Omega_2(q_b)q_a. \] In fact, the two linear maps $\Omega_1$ and $\Omega_2$ have more interesting properties, and you are asked to prove the following equalities:</p>
<ol>
<li>For any unit quaternion $q$, both $\Omega_1(q)$ and $\Omega_2(q)$ are <em>orthogonal</em> matrices, <em>i.e.</em>, \[ \Omega_1(q)^T\Omega_1(q) = \Omega_1(q)\Omega_1(q)^T = I_4, \] \[ \Omega_2(q)^T\Omega_2(q) = \Omega_2(q)\Omega_2(q)^T = I_4. \] Intuitively, what is the reason that both $\Omega_1(q)$ and $\Omega_2(q)$ must be orthogonal?<ul><li class="hint">Hint: what does $q_a \otimes q_b$ still being a unit quaternion imply?</li></ul>
</li>
<li><p>For any unit quaternion $q$, both $\Omega_1(q)$ and $\Omega_2(q)$ convert $q$ to be the unit quaternion that corresponds to the 3D identity rotation, <em>i.e.</em>, \[ \Omega_1(q)^Tq = \Omega_2(q)^Tq = [0,0,0,1]^T. \]</p></li>
<li>For any two vectors $x,y \in \mathbb{R}^4$, show the two linear operators commute, <em>i.e.</em>, \[ \Omega_1(x) \Omega_2(y) = \Omega_2(y) \Omega_1(x), \] \[ \Omega_1(x) \Omega_2(y)^T = \Omega_2(y)^T \Omega_1(x). \]</li>
</ol>
<h3 id="-optional-deliverable-6---intrinsic-vs-extrinsic-rotations-20-pts"> <a href="#-optional-deliverable-6---intrinsic-vs-extrinsic-rotations-20-pts" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> 📨 [Optional] Deliverable 6 - Intrinsic vs Extrinsic rotations (20 pts)</h3>
<p>Consider the following sequence of rotations:</p>
<ul>
<li>$R_0$: 90° around $x$</li>
<li>$R_1$: 180° around $y$</li>
<li>$R_2$ -30° around $x$</li>
</ul>
<p><em>A)</em> Extrinsic</p>
<p>The sequence of rotations is applied with respect to a fixed frame of reference (the world frame), as follows:</p>
<p><img src="https://mit-spark.github.io/VNAV2020-handouts/assets/images/lab2/guitar-01.png" alt="Extrinsic rotations"></p>
<p><em>Note</em>: the body axes are unlabeled, but represented in red ($x_b$), green ($y_b$), blue ($z_b$)</p>
<p><em>B)</em> Intrinsic</p>
<p>The sequence of rotations is applied in <em>reverse order</em> with respect to a frame of reference attached to the object (the body frame), as follows:</p>
<p><img src="https://mit-spark.github.io/VNAV2020-handouts/assets/images/lab2/guitar-02.png" alt="Intrinsic rotations"></p>
<p><strong>Note that the final orientation of the object is the same in both cases!</strong></p>
<p>This property is quite general: it holds regardless of the specific axes and angles of the rotations and for any number of rotations in the sequence.</p>
<p>Could you prove this formally?</p>
<hr>
<footer role="contentinfo"><p class="text-small text-grey-dk-000 mb-0"><a href="http://accessibility.mit.edu" target="_blank" rel="noopener noreferrer">Accessibility.</a> Copyright © 2017-2020 MIT SPARK Lab. Using <a href="https://github.com/pmarsceill/just-the-docs/tree/master" target="_blank" rel="noopener noreferrer">Just the docs</a> theme.</p></footer>
</div>
</div>
</div></div>
</div>