<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><title>Introduction to ROS - VNAV2020</title><link rel="shortcut icon" href="https://mit-spark.github.io/VNAV2020-handouts/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="https://mit-spark.github.io/VNAV2020-handouts/assets/css/just-the-docs.css"> <script src="https://use.fontawesome.com/d81b2d50d8.js"></script> <script type="text/javascript" src="https://mit-spark.github.io/VNAV2020-handouts/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="https://mit-spark.github.io/VNAV2020-handouts/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Introduction to ROS | VNAV2020</title><meta name="generator" content="Jekyll v3.8.6" /><meta property="og:title" content="Introduction to ROS" /><meta property="og:locale" content="en_US" /><meta name="description" content="16.485 - Visual Navigation for Autonomous Vehicles (2020)" /><meta property="og:description" content="16.485 - Visual Navigation for Autonomous Vehicles (2020)" /><link rel="canonical" href="https://mit-spark.github.io/VNAV2020-handouts/lab2/ros101" /><meta property="og:url" content="https://mit-spark.github.io/VNAV2020-handouts/lab2/ros101" /><meta property="og:site_name" content="VNAV2020" /> <script type="application/ld+json"> {"@type":"WebPage","headline":"Introduction to ROS","url":"https://mit-spark.github.io/VNAV2020-handouts/lab2/ros101","description":"16.485 - Visual Navigation for Autonomous Vehicles (2020)","@context":"https://schema.org"}</script> <script type="text/javascript" src="https://mit-spark.github.io/VNAV2020-handouts/assets/js/vendor/lazysizes.min.js" async=""></script><body><div class="page-wrap">
<div class="side-bar">
<div class="site-header"> <a href="https://mit-spark.github.io/VNAV2020-handouts/" class="site-title lh-tight">VNAV2020</a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button>
</div>
<div class="navigation main-nav js-main-nav"><nav role="navigation" aria-label="Main navigation"><ul class="navigation-list">
<li class="navigation-list-item"><a href="https://mit-spark.github.io/VNAV2020-handouts/" class="navigation-list-link">Home</a></li>
<li class="navigation-list-item">
<a href="https://mit-spark.github.io/VNAV2020-handouts/lab1/" class="navigation-list-link">Lab 1</a><ul class="navigation-list-child-list ">
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab1/ubuntu" class="navigation-list-link">Install Ubuntu 18.04</a></li>
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab1/shell" class="navigation-list-link">Shell basics</a></li>
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab1/git" class="navigation-list-link">Git</a></li>
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab1/cpp" class="navigation-list-link">C++</a></li>
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab1/exercises" class="navigation-list-link">Exercises</a></li>
</ul>
</li>
<li class="navigation-list-item active">
<a href="https://mit-spark.github.io/VNAV2020-handouts/lab2/" class="navigation-list-link">Lab 2</a><ul class="navigation-list-child-list ">
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab2/ros" class="navigation-list-link">Installing ROS</a></li>
<li class="navigation-list-item active"><a href="https://mit-spark.github.io/VNAV2020-handouts/lab2/ros101" class="navigation-list-link active">Introduction to ROS</a></li>
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab2/exercises" class="navigation-list-link">Exercises</a></li>
</ul>
</li>
<li class="navigation-list-item">
<a href="https://mit-spark.github.io/VNAV2020-handouts/lab3/" class="navigation-list-link">Lab 3</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab3/exercises" class="navigation-list-link">Exercises</a></li></ul>
</li>
<li class="navigation-list-item">
<a href="https://mit-spark.github.io/VNAV2020-handouts/lab4/" class="navigation-list-link">Lab 4</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab4/exercises" class="navigation-list-link">Exercises</a></li></ul>
</li>
<li class="navigation-list-item"><a href="https://mit-spark.github.io/VNAV2020-handouts/about" class="navigation-list-link">How to print</a></li>
</ul></nav></div>
<footer class="site-footer"><p class="text-small text-grey-dk-000 mb-4"><b>Last modified</b>:<br> Wednesday, September 23 at 14:39</p></footer>
</div>
<div class="main-content-wrap js-main-content" tabindex="0"><div class="main-content">
<div class="page-header js-page-header"><div class="search">
<div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search VNAV2020" aria-label="Search VNAV2020" autocomplete="off"> <svg width="14" height="14" viewbox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title>
<g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"></path><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"></path></g></svg>
</div>
<div class="js-search-results search-results-wrap"></div>
</div></div>
<div class="page">
<nav class="breadcrumb-nav"><ol class="breadcrumb-nav-list">
<li class="breadcrumb-nav-list-item"><a href="https://mit-spark.github.io/VNAV2020-handouts/lab2/">Lab 2</a></li>
<li class="breadcrumb-nav-list-item"><span>Introduction to ROS</span></li>
</ol></nav><div id="main-content" class="page-content" role="main">
<h1 class="no_toc text-delta fs-9" id="ros-intro"> <a href="#ros-intro" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> ROS Intro</h1>
<h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Table of contents</h2>
<ol id="markdown-toc">
<li>
<a href="#ros-file-system-structure" id="markdown-toc-ros-file-system-structure">ROS file system structure</a><ol>
<li><a href="#general-structure" id="markdown-toc-general-structure">General structure</a></li>
<li><a href="#the-workspace" id="markdown-toc-the-workspace">The workspace</a></li>
</ol>
</li>
<li>
<a href="#ros-master-nodes-and-topics" id="markdown-toc-ros-master-nodes-and-topics">ROS Master, nodes and topics</a><ol>
<li><a href="#ros-master" id="markdown-toc-ros-master">ROS Master</a></li>
<li><a href="#ros-nodes" id="markdown-toc-ros-nodes">ROS nodes</a></li>
<li><a href="#ros-topics" id="markdown-toc-ros-topics">ROS topics</a></li>
</ol>
</li>
<li><a href="#anatomy-of-a-ros-node" id="markdown-toc-anatomy-of-a-ros-node">Anatomy of a ROS node</a></li>
<li><a href="#launch-files" id="markdown-toc-launch-files">Launch files</a></li>
<li>
<a href="#transforms-tf-package" id="markdown-toc-transforms-tf-package">Transforms (tf package)</a><ol><li>
<a href="#quick-overview-of-tf-tools" id="markdown-toc-quick-overview-of-tf-tools">Quick overview of tf tools</a><ol>
<li><a href="#using-view_frames" id="markdown-toc-using-view_frames">Using <code class="highlighter-rouge">view_frames</code></a></li>
<li><a href="#using-rqt_tf_tree" id="markdown-toc-using-rqt_tf_tree">Using <code class="highlighter-rouge">rqt_tf_tree</code></a></li>
<li><a href="#using-tf_echo" id="markdown-toc-using-tf_echo">Using <code class="highlighter-rouge">tf_echo</code></a></li>
<li><a href="#usign-rviz" id="markdown-toc-usign-rviz">Usign RViz</a></li>
</ol>
</li></ol>
</li>
<li><a href="#additional-resources" id="markdown-toc-additional-resources">Additional resources</a></li>
</ol>
<h2 id="ros-file-system-structure"> <a href="#ros-file-system-structure" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> ROS file system structure</h2>
<h3 id="general-structure"> <a href="#general-structure" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> General structure</h3>
<p>Similar to an operating system, ROS files are also organized in a particular fashion. The following graph shows how ROS files and folder are organized on the disk:</p>
<p><img src="https://static.packt-cdn.com/products/9781783987580/graphics/7580OS_02_01.jpg" alt="ROS FS Structure" class="mx-auto d-block"></p>
<p>The ROS <strong>packages</strong> are the most basic unit of the ROS software. They contain the ROS runtime process (<strong>nodes</strong>), libraries, configuration files, and so on, which are organized together as a single unit. Packages are the atomic build item and release item in the ROS software.</p>
<p>Inside a package we can find the <strong>package manifest</strong> file, which contains information about the package, author, license, dependencies, compilation flags, and so on. The <code class="highlighter-rouge">package.xml</code> file inside the ROS package is the manifest file of that package.</p>
<p>The ROS <strong>messages</strong> are a type of information that is sent from one ROS process to the other. They are regular text files with <code class="highlighter-rouge">.msg</code> extension that define the fields of the messages.</p>
<p>The ROS <strong>service</strong> is a kind of request/reply interaction between processes. The reply and request data types can be defined inside the <code class="highlighter-rouge">srv</code> folder inside the package.</p>
<p>For example, the package we will develop in this lab will be like</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
└── two_drones_pkg
    ├── CMakeLists.txt
    ├── README.md
    ├── config
    │   └── default.rviz
    ├── launch
    │   └── two_drones.launch
    ├── mesh
    │   └── quadrotor.dae
    ├── package.xml
    └── src
        ├── frames_publisher_node.cpp
        └── plots_publisher_node.cpp
</code></pre></div></div>
<h3 id="the-workspace"> <a href="#the-workspace" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> The workspace</h3>
<p>In general terms, the workspace is a folder which contains packages, those packages contain our source files and the environment or workspace provides us with a way to compile those packages. It is useful when we want to compile various packages at the same time and it is a good way of centralizing all of our developments.</p>
<h2 id="ros-master-nodes-and-topics"> <a href="#ros-master-nodes-and-topics" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> ROS Master, nodes and topics</h2>
<p>One of the primary purposes of ROS is to facilitate communication between the ROS modules called nodes. Those nodes can be executed on a single machine or across several machines, obtaining a distributed system. The advantage of this structure is that each node can control one aspect of a system. For example you might have several nodes each be responsible of parsing row data from sensors and one node to process them.</p>
<h3 id="ros-master"> <a href="#ros-master" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> ROS Master</h3>
<p>Communication between nodes is established by the ROS Master. The ROS Master provides naming and registration services to the nodes in the ROS system. It is its job to track <strong>publishers</strong> and <strong>subscribers</strong> to the <strong>topics</strong>.</p>
<p>ROS master works much like a DNS server. Whenever any node starts in the ROS system, it will start looking for ROS master and register the name of the node with ROS master. Therefore, ROS master has information about all the nodes that are currently running on the ROS system. When information about any node changes, it will generate a call back and update with the latest information.</p>
<p><img src="https://mit-spark.github.io/VNAV2020-handouts/assets/images/lab2/ros_communication.png" alt="ROS communication"></p>
<p>ROS Master distributes the information about the topics to the nodes. Before a node can publish to a topic, it sends the details of the topic, such as its name and data type, to ROS master. ROS master will check whether any other nodes are subscribed to the same topic. If any nodes are subscribed to the same topic, ROS master will share the node details of the publisher to the subscriber node.</p>
<p>After receiving the node details, these two nodes will interconnect using the TCPROS protocol, which is based on TCP/IP sockets, and ROS master will relinquish its role in controlling them.</p>
<p>To start ROS master, open a terminal and run</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roscore
</code></pre></div></div>
<p>Any ROS system must have <strong>only one master</strong>, even in a distributed system, and it should run on a computer that is reachable by all other computers to ensure that remote ROS nodes can access the master.</p>
<h3 id="ros-nodes"> <a href="#ros-nodes" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> ROS nodes</h3>
<p>Basically, nodes are regular processes but with the capability to register with the ROS Master node and communicate with other nodes in the system. The ROS design idea is that each node is an independent module that interacts with other nodes using the ROS communication capability.</p>
<p>The nodes can be created in various ways. From a terminal window a node can be created directly by typing a command after the command prompt, as shown in the examples to follow. Alternatively, nodes can be created as part of a program written in Python or C++. In this lab, we will use both the ROS commands in a terminal window and Python programs to create nodes.</p>
<p>As example let’s run the <code class="highlighter-rouge">turtlesim</code> node, in a new terminal run</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosrun turtlesim turtlesim_node
</code></pre></div></div>
<p>Yous should see something like</p>
<p><img src="https://mit-spark.github.io/VNAV2020-handouts/assets/images/lab2/turtlesim.png" alt="Turtlesim" class="mx-auto d-block img-size-60"></p>
<p>Now, you can ask the ROS master about the running nodes with</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rosnode list
/rosout
/turtlesim
</code></pre></div></div>
<p>Now, let’s run another node</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosrun turtlesim turtle_teleop_key
</code></pre></div></div>
<p>Now the list of node changed</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rosnode list
/rosout
/teleop_turtle
/turtlesim
</code></pre></div></div>
<h3 id="ros-topics"> <a href="#ros-topics" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> ROS topics</h3>
<p>Topics are the means used by nodes to transmit data, it represents the channel where messages are sent and it has a message type attached to it (you cannot send different types of messages in a topic). In ROS, data production and consumption are decoupled, this means that a node can publish message (producer) or subscribe to a topic (consumer).</p>
<p>Let’s use <code class="highlighter-rouge">rqt_graph</code> which shows the nodes and topics currently running.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosrun rqt_graph rqt_graph
</code></pre></div></div>
<p>If you select <em>Nodes/Topics (all)</em> from the top left and deselect <em>Debug</em> you will see something similar to</p>
<p><img src="https://mit-spark.github.io/VNAV2020-handouts/assets/images/lab2/rqt_graph.png" alt="rqt_graph"></p>
<p>In the graph the ellipses are nodes and the squares are topics. From the picture it’s easy to see that <code class="highlighter-rouge">teleop_turtle</code> is publishing to <code class="highlighter-rouge">/turtle1/cmd_vel</code> topic. The node <code class="highlighter-rouge">/turtlesim</code> is subscribed to the topic and uses the incoming messages to move the turtle.</p>
<p>You can also print the messages to the terminal. Try tu run <code class="highlighter-rouge">rostopic echo /turtle1/cmd_vel</code> and move the turtle, you should get something like</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rostopic <span class="nb">echo</span> /turtle1/cmd_vel
linear:
  x: 0.0
  y: 0.0
  z: 0.0
angular:
  x: 0.0
  y: 0.0
  z: <span class="nt">-2</span>.0
<span class="nt">---</span>
</code></pre></div></div>
<p>These are very useful tools to debug your nodes.</p>
<h2 id="anatomy-of-a-ros-node"> <a href="#anatomy-of-a-ros-node" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Anatomy of a ROS node</h2>
<p>The simplest C++ ROS node has a structure similar to the following</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include "ros/ros.h"
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ros</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="s">"example_node"</span><span class="p">);</span>
  <span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span> <span class="n">n</span><span class="p">;</span>

  <span class="n">ros</span><span class="o">::</span><span class="n">Rate</span> <span class="n">loop_rate</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>

  <span class="k">while</span> <span class="p">(</span><span class="n">ros</span><span class="o">::</span><span class="n">ok</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// ... do some useful things ...</span>
    <span class="n">ros</span><span class="o">::</span><span class="n">spinOnce</span><span class="p">();</span>
    <span class="n">loop_rate</span><span class="p">.</span><span class="n">sleep</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Let’s analyze it line by line: the first line</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include "ros/ros.h"
</span></code></pre></div></div>
<p>adds the <a href="http://docs.ros.org/melodic/api/roscpp/html/ros_8h.html" target="_blank" rel="noopener noreferrer">header</a> containing all the basic ROS functionality. At the beginning of the main of the program</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ros</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="s">"example_node"</span><span class="p">);</span>
</code></pre></div></div>
<p><code class="highlighter-rouge">ros::init</code> initialize the node, it is responsible for collecting ROS specific information from arguments passed at the command line and set the node name (remember: names must be <strong>unique</strong> across the ROS system). But it <strong>does not</strong> contact the master. To contact the master and register the node we need to call</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ros</span><span class="o">::</span><span class="n">NodeHandle</span> <span class="n">n</span><span class="p">;</span>
</code></pre></div></div>
<p>When the first <code class="highlighter-rouge">ros::NodeHandle</code> is created it will call <code class="highlighter-rouge">ros::start()</code>, and when the last ros::NodeHandle is destroyed (e.g. goes out of scope), it will call <code class="highlighter-rouge">ros::shutdown()</code>. This is the most common way of handling the lifetime of a ROS node.</p>
<p>Usually we want to run our node at a given frequency, to set the node frequency we use</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ros</span><span class="o">::</span><span class="n">Rate</span> <span class="nf">loop_rate</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
</code></pre></div></div>
<p>which is setting the desired rate at 50 Hz. Than we have the <strong>main loop</strong> of the node. Since we want to run this node until the ROS we need to the check the various states of shutdown. The most common way to do it is to call <code class="highlighter-rouge">ros::ok()</code>. Once <code class="highlighter-rouge">ros::ok()</code> returns false, the node has finished shutting down. That’s why we have</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="p">(</span><span class="n">ros</span><span class="o">::</span><span class="n">ok</span><span class="p">())</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Inside the loop we can make interesting things happen. In our example we simply run</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ros</span><span class="o">::</span><span class="n">spinOnce</span><span class="p">();</span>
<span class="n">loop_rate</span><span class="p">.</span><span class="n">sleep</span><span class="p">();</span>
</code></pre></div></div>
<p>The function <code class="highlighter-rouge">ros::spinOnce()</code> will call all the callbacks waiting to be called at that point in time while. If you remember we set the node frequency to 50Hz, the code we are running will probably take less than 20ms. The function <code class="highlighter-rouge">loop_rate.sleep()</code> will pause the node the remaining time.</p>
<h2 id="launch-files"> <a href="#launch-files" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Launch files</h2>
<p>Launch files are the preferred way to run ROS nodes. The launch files provide a convenient interface to execute multiple nodes and a master (if is not already running), as well as other initialization requirements such as parameters.</p>
<p>Usually the launch files are located in the <code class="highlighter-rouge">launch</code> folder of the package and have <code class="highlighter-rouge">.launch</code> extension. If the package provide one you can use <code class="highlighter-rouge">roslaunch</code> to use it.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch &lt;package_name&gt; &lt;launch_file&gt;
</code></pre></div></div>
<p><strong>Note:</strong> Pushing <kbd>CTRL</kbd>+<kbd>c</kbd> in a terminal with a launch file running will close all nodes that were started with that launch files.</p>
<p>An example of launch file is</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;launch&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"map_server"</span> <span class="na">pkg=</span><span class="s">"map_server"</span> <span class="na">type=</span><span class="s">"mapserver"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"stageros"</span> <span class="na">pkg=</span><span class="s">"stage"</span> <span class="na">type=</span><span class="s">"stageros"</span> <span class="na">args=</span><span class="s">"$(find navigation_stage)/stage config/worlds/willow-pr2-5cm.world"</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"base_watchdog_timeout"</span> <span class="na">value=</span><span class="s">"0.2"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/node&gt;</span>
  <span class="nt">&lt;include</span> <span class="na">file=</span><span class="s">"$(find navigation_stage)/move_base_config/amcl_node.xml"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</code></pre></div></div>
<p>This example will run three nodes (plus the master if not already running), each <code class="highlighter-rouge">&lt;node&gt;...&lt;/node&gt;</code> is equivalent to a <code class="highlighter-rouge">rosrun</code> call, for example</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"stageros"</span> <span class="na">pkg=</span><span class="s">"stage"</span> <span class="na">type=</span><span class="s">"stageros"</span> <span class="na">args=</span><span class="s">"$(find navigation_stage)/stage_config/worlds/willow-pr2-5cm.world"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>
<p>is equivalent to</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosrun stage stageros &lt;path-to-navigation-stage-package&gt;/stage_config/worlds/willow-pr2-5cm.world
</code></pre></div></div>
<p>This tool gives the possibility to add complex and dynamic runtime behavior such as <code class="highlighter-rouge">$(find path)</code>, <code class="highlighter-rouge">unless</code> and <code class="highlighter-rouge">if</code> or include other launch files.</p>
<h2 id="transforms-tf-package"> <a href="#transforms-tf-package" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Transforms (tf package)</h2>
<p>The ROS tf library has been developed to provide a standard method to keep track of coordinate frames and transform data within the entire system so that users can be confident about the consistency of their data in a particular coordinate frame without requiring knowledge about all the other coordinate frames in the system and their associations.</p>
<p>tf is distributed across nodes (across machines too, eventually) and there are two types of tf nodes</p>
<ul>
<li>Listener: that listen to <code class="highlighter-rouge">/tf</code> and cache all data that it collected (up to cache limit)</li>
<li>Broadcaster: that publish transforms between coordinate frames on <code class="highlighter-rouge">/tf</code>
</li>
</ul>
<p>In tf, transforms and coordinate frames are represented as a graph with the transforms as edges and the coordinate frames as nodes. The advantage of this representation is that the relative pose between two nodes is simply the product of the edges connecting the two nodes. A tree structure has also the benefit of allowing for dynamic changes easily. tf indeed takes care of ambiguity of transforms not allowing loops in the transforms graph.</p>
<div class="alert alert-info"><div class="alert-content">
<h2 class="alert-title"> Where to learn TF.</h2>
<div class="alert-body">
<p>The best resource to learn TF out there is the official <a href="http://wiki.ros.org/tf2/Tutorials" target="_blank" rel="noopener noreferrer">ROS tf tutorials</a>.</p>
<p>Take your time to familiarize with the Listener/Broadcaster code, you'll need for the exercises.</p>
<br><p>Of course do not forget the <a href="http://docs.ros.org/melodic/api/tf/html/c++/namespacetf.html" target="_blank" rel="noopener noreferrer">official documentation.</a></p>
</div>
</div></div>
<h3 id="quick-overview-of-tf-tools"> <a href="#quick-overview-of-tf-tools" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Quick overview of tf tools</h3>
<p>Let’s see the tools we have to explore the tf tree.</p>
<p>ROS provides a simple demo we are going to use, from a terminal run</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch turtle_tf turtle_tf_demo.launch
</code></pre></div></div>
<p>Once the turtlesim demo is started, we will drive the center turtle around in turtlesim using the keyboard arrow keys. We can observe that one turtle will continuously follow the turtle we are driving. In this demo application, the ROS TF library is used to create three coordinate frames: a world frame, a turtle1 frame, and a turtle2 frame, and to create a TF broadcaster to publish the coordinate frames of the first turtle and a TF listener to compute the difference between the first and follower turtle frames, as well as drive the second turtle to follow the first.</p>
<h4 id="using-view_frames"> <a href="#using-view_frames" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Using <code class="highlighter-rouge">view_frames</code>
</h4>
<p>The <code class="highlighter-rouge">view_frame</code>s tool creates a diagram of the frames being broadcast by TF over ROS:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosrun tf view_frames
evince frames.pdf
</code></pre></div></div>
<p><img src="https://mit-spark.github.io/VNAV2020-handouts/assets/images/lab2/turtle_tf_view.png" alt="view_frames example"></p>
<p>Here, you can see that three frames are broadcast by TF—the <code class="highlighter-rouge">world</code>, <code class="highlighter-rouge">turtle1</code>, and <code class="highlighter-rouge">turtle2</code>, where the <code class="highlighter-rouge">world</code> frame is the parent of the <code class="highlighter-rouge">turtle1</code> and <code class="highlighter-rouge">turtle2</code> frames.</p>
<h4 id="using-rqt_tf_tree"> <a href="#using-rqt_tf_tree" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Using <code class="highlighter-rouge">rqt_tf_tree</code>
</h4>
<p>The rqt_tf_tree tool enables the real-time visualization of the tree of frames being broadcast over ROS</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosrun rqt_tf_tree rqt_tf_tree
</code></pre></div></div>
<p><img src="https://mit-spark.github.io/VNAV2020-handouts/assets/images/lab2/turtle_rqt_tf_tree.png" alt="rqt_tf_tree example"></p>
<h4 id="using-tf_echo"> <a href="#using-tf_echo" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Using <code class="highlighter-rouge">tf_echo</code>
</h4>
<p>The tf_echo tool reports the transformation between any two frames broadcast over ROS</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosrun tf tf_echo <span class="o">[</span>reference_frame] <span class="o">[</span>target_frame]
</code></pre></div></div>
<p>For example</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rosrun tf tf_echo turtle1 turtle2
At <span class="nb">time </span>1568050753.324
- Translation: <span class="o">[</span>0.000, 0.000, 0.000]
- Rotation: <span class="k">in </span>Quaternion <span class="o">[</span>0.000, 0.000, 0.344, 0.939]
            <span class="k">in </span>RPY <span class="o">(</span>radian<span class="o">)</span> <span class="o">[</span>0.000, <span class="nt">-0</span>.000, 0.703]
            <span class="k">in </span>RPY <span class="o">(</span>degree<span class="o">)</span> <span class="o">[</span>0.000, <span class="nt">-0</span>.000, 40.275]
</code></pre></div></div>
<h4 id="usign-rviz"> <a href="#usign-rviz" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Usign RViz</h4>
<p><em>RViz</em> is a graphical 3D visualization tool that is useful for viewing the association between TF frames within the ROS system:</p>
<p><img src="https://mit-spark.github.io/VNAV2020-handouts/assets/images/lab2/turtle_rviz.png" alt="RViz example"></p>
<p>You can run <em>RViz</em> just running</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rviz
</code></pre></div></div>
<p>One it is started, you need to press the button <em>Add</em> to add the <em>TF</em> in the visualization and set the correct <em>Fixed Frame</em> (i.e. <code class="highlighter-rouge">world</code>).</p>
<h2 id="additional-resources"> <a href="#additional-resources" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Additional resources</h2>
<p>Of course there are many details we haven’t discussed here, below you can find resources we find interesting</p>
<ul>
<li><a href="http://wiki.ros.org/ROS/Tutorials" target="_blank" rel="noopener noreferrer">Official ROS tutorial</a></li>
<li><a href="https://www.cse.sc.edu/~jokane/agitr/" target="_blank" rel="noopener noreferrer">A Gentle Introduction to ROS</a></li>
<li><a href="https://www.youtube.com/channel/UCt6Lag-vv25fTX3e11mVY1Q/playlists" target="_blank" rel="noopener noreferrer">Free videos from Robot Ignite Academy</a></li>
<li><a href="https://www.amazon.com/Programming-Robots-ROS-Practical-Introduction/dp/1449323898" target="_blank" rel="noopener noreferrer">Programming Robots with ROS</a></li>
</ul>
<hr>
<footer role="contentinfo"><p class="text-small text-grey-dk-000 mb-0"><a href="http://accessibility.mit.edu" target="_blank" rel="noopener noreferrer">Accessibility.</a> Copyright © 2017-2020 MIT SPARK Lab. Using <a href="https://github.com/pmarsceill/just-the-docs/tree/master" target="_blank" rel="noopener noreferrer">Just the docs</a> theme.</p></footer>
</div>
</div>
</div></div>
</div>