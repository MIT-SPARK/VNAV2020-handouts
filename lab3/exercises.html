<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><title>Exercises - VNAV2020</title><link rel="shortcut icon" href="https://mit-spark.github.io/VNAV2020-handouts/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="https://mit-spark.github.io/VNAV2020-handouts/assets/css/just-the-docs.css"> <script src="https://use.fontawesome.com/d81b2d50d8.js"></script> <script type="text/javascript" src="https://mit-spark.github.io/VNAV2020-handouts/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="https://mit-spark.github.io/VNAV2020-handouts/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Exercises | VNAV2020</title><meta name="generator" content="Jekyll v3.8.6" /><meta property="og:title" content="Exercises" /><meta property="og:locale" content="en_US" /><meta name="description" content="16.485 - Visual Navigation for Autonomous Vehicles (2020)" /><meta property="og:description" content="16.485 - Visual Navigation for Autonomous Vehicles (2020)" /><link rel="canonical" href="https://mit-spark.github.io/VNAV2020-handouts/lab3/exercises" /><meta property="og:url" content="https://mit-spark.github.io/VNAV2020-handouts/lab3/exercises" /><meta property="og:site_name" content="VNAV2020" /> <script type="application/ld+json"> {"headline":"Exercises","description":"16.485 - Visual Navigation for Autonomous Vehicles (2020)","url":"https://mit-spark.github.io/VNAV2020-handouts/lab3/exercises","@type":"WebPage","@context":"https://schema.org"}</script> <script> window.MathJax = { options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'], }, loader: { load: ['input/tex', '[tex]/ams', '[tex]/configMacros'] }, tex: { packages: {'[+]': ['boldsymbol', 'ams', 'configMacros']}, inlineMath: [['$','$'], ['\\(','\\)']], displayMath: [["$$", "$$"], ["\\[","\\]"]], processEscapes: true, tags: "ams", macros: { SE: ['\\mathrm{SE}(#1)', 1], SO: ['\\mathrm{SO}(#1)', 1], argmin: '\\mathop{\\operatorname{argmin}}', argmax: '\\mathop{\\operatorname{argmax}}', trace: '\\operatorname{trace}', tran: '^{\\mathsf{T}}', }, }, }; </script> <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" async></script> <script type="text/javascript" src="https://mit-spark.github.io/VNAV2020-handouts/assets/js/vendor/lazysizes.min.js" async=""></script><body><div class="page-wrap">
<div class="side-bar">
<div class="site-header"> <a href="https://mit-spark.github.io/VNAV2020-handouts/" class="site-title lh-tight">VNAV2020</a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button>
</div>
<div class="navigation main-nav js-main-nav"><nav role="navigation" aria-label="Main navigation"><ul class="navigation-list">
<li class="navigation-list-item"><a href="https://mit-spark.github.io/VNAV2020-handouts/" class="navigation-list-link">Home</a></li>
<li class="navigation-list-item">
<a href="https://mit-spark.github.io/VNAV2020-handouts/lab1/" class="navigation-list-link">Lab 1</a><ul class="navigation-list-child-list ">
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab1/ubuntu" class="navigation-list-link">Install Ubuntu 18.04</a></li>
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab1/shell" class="navigation-list-link">Shell basics</a></li>
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab1/git" class="navigation-list-link">Git</a></li>
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab1/cpp" class="navigation-list-link">C++</a></li>
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab1/exercises" class="navigation-list-link">Exercises</a></li>
</ul>
</li>
<li class="navigation-list-item">
<a href="https://mit-spark.github.io/VNAV2020-handouts/lab2/" class="navigation-list-link">Lab 2</a><ul class="navigation-list-child-list ">
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab2/ros" class="navigation-list-link">Installing ROS</a></li>
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab2/ros101" class="navigation-list-link">Introduction to ROS</a></li>
<li class="navigation-list-item "><a href="https://mit-spark.github.io/VNAV2020-handouts/lab2/exercises" class="navigation-list-link">Exercises</a></li>
</ul>
</li>
<li class="navigation-list-item active">
<a href="https://mit-spark.github.io/VNAV2020-handouts/lab3/" class="navigation-list-link">Lab 3</a><ul class="navigation-list-child-list "><li class="navigation-list-item active"><a href="https://mit-spark.github.io/VNAV2020-handouts/lab3/exercises" class="navigation-list-link active">Exercises</a></li></ul>
</li>
<li class="navigation-list-item"><a href="https://mit-spark.github.io/VNAV2020-handouts/about" class="navigation-list-link">How to print</a></li>
</ul></nav></div>
<footer class="site-footer"><p class="text-small text-grey-dk-000 mb-4"><b>Last modified</b>:<br> Wednesday, September 16 at 16:42</p></footer>
</div>
<div class="main-content-wrap js-main-content" tabindex="0"><div class="main-content">
<div class="page-header js-page-header"><div class="search">
<div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search VNAV2020" aria-label="Search VNAV2020" autocomplete="off"> <svg width="14" height="14" viewbox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title>
<g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"></path><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"></path></g></svg>
</div>
<div class="js-search-results search-results-wrap"></div>
</div></div>
<div class="page">
<nav class="breadcrumb-nav"><ol class="breadcrumb-nav-list">
<li class="breadcrumb-nav-list-item"><a href="https://mit-spark.github.io/VNAV2020-handouts/lab3/">Lab 3</a></li>
<li class="breadcrumb-nav-list-item"><span>Exercises</span></li>
</ol></nav><div id="main-content" class="page-content" role="main">
<h1 class="no_toc text-delta fs-9" id="exercises"> <a href="#exercises" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Exercises</h1>
<ol id="markdown-toc">
<li>
<a href="#submission" id="markdown-toc-submission">Submission</a><ol>
<li><a href="#individual" id="markdown-toc-individual">Individual</a></li>
<li><a href="#team" id="markdown-toc-team">Team</a></li>
<li><a href="#deadline" id="markdown-toc-deadline">Deadline</a></li>
</ol>
</li>
<li>
<a href="#individual-1" id="markdown-toc-individual-1">Individual</a><ol>
<li><a href="#deliverable-1---transformations-in-practice-10-pts" id="markdown-toc-deliverable-1---transformations-in-practice-10-pts">Deliverable 1 - Transformations in Practice (10 pts)</a></li>
<li><a href="#deliverable-2---modelling-and-control-of-uavs-20-pts" id="markdown-toc-deliverable-2---modelling-and-control-of-uavs-20-pts">Deliverable 2 - Modelling and control of UAVs (20 pts)</a></li>
</ol>
</li>
<li>
<a href="#team-1" id="markdown-toc-team-1">Team</a><ol>
<li>
<a href="#trajectory-tracking-for-uavs" id="markdown-toc-trajectory-tracking-for-uavs">Trajectory tracking for UAVs</a><ol><li><a href="#getting-the-codebase" id="markdown-toc-getting-the-codebase">Getting the codebase</a></li></ol>
</li>
<li><a href="#launching-the-tesse-simulator-with-ros-bridge" id="markdown-toc-launching-the-tesse-simulator-with-ros-bridge">Launching the TESSE simulator with ROS bridge</a></li>
<li><a href="#implement-the-controller" id="markdown-toc-implement-the-controller">Implement the controller</a></li>
<li><a href="#simulator-conventions" id="markdown-toc-simulator-conventions">Simulator conventions</a></li>
<li>
<a href="#deliverable-3---geometric-controller-for-the-uav-50-pts" id="markdown-toc-deliverable-3---geometric-controller-for-the-uav-50-pts">Deliverable 3 - Geometric controller for the UAV (50 pts)</a><ol>
<li><a href="#how-to-test" id="markdown-toc-how-to-test">How to test</a></li>
<li><a href="#tuning-tips" id="markdown-toc-tuning-tips">Tuning tips</a></li>
<li><a href="#what-to-expect" id="markdown-toc-what-to-expect">What to expect</a></li>
</ol>
</li>
</ol>
</li>
<li><a href="#references" id="markdown-toc-references">References</a></li>
</ol>
<h2 id="submission"> <a href="#submission" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Submission</h2>
<p>To submit your solutions create a folder called <code class="highlighter-rouge">lab3</code> and push one or more file to your repository with your answers (it can be plain text, markdown, pdf or whatever other format is reasonably easy to read)</p>
<h3 id="individual"> <a href="#individual" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Individual</h3>
<p>Please push the deliverables into your personal repository, for math-related questions LaTeX is preferred but handwritten is accepted too.</p>
<h3 id="team"> <a href="#team" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Team</h3>
<p>Create a new repository in <a href="https://github.mit.edu/VNAV2020-submissions" target="_blank" rel="noopener noreferrer">VNAV2020-submission</a> called <code class="highlighter-rouge">TEAM_&lt;N&gt;</code>, replacing <code class="highlighter-rouge">&lt;N&gt;</code> with your team number. For example team 2 will create the repository <code class="highlighter-rouge">TEAM_2</code>.</p>
<p>Please push the source code of the entire <code class="highlighter-rouge">controller_pkg</code> package in the foder <code class="highlighter-rouge">lab3</code> of the team repository.</p>
<h3 id="deadline"> <a href="#deadline" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Deadline</h3>
<p><strong>Deadline:</strong> the VNAV staff will clone your repository on <strong>September 23th, 2020</strong> at midnight.</p>
<h2 id="individual-1"> <a href="#individual-1" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Individual</h2>
<h3 id="deliverable-1---transformations-in-practice-10-pts"> <a href="#deliverable-1---transformations-in-practice-10-pts" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Deliverable 1 - Transformations in Practice (10 pts)</h3>
<p>This exercise will help you to understand how to perform transformation between different rotation representations using ROS. In addition, you will gain experience of reading through a documentation in order to find what you need.</p>
<h4 class="no_toc" id="a-message-vs-tf"> <a href="#a-message-vs-tf" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <em>A</em>. Message vs. tf</h4>
<p>In ROS, there are two commonly used datatypes for quaternions. One is <a href="http://docs.ros.org/api/geometry_msgs/html/msg/Quaternion.html" target="_blank" rel="noopener noreferrer"><code class="highlighter-rouge">geometry_msgs::Quaternion</code></a> and the other is <a href="http://docs.ros.org/melodic/api/tf2/html/classtf2_1_1Quaternion.html" target="_blank" rel="noopener noreferrer"><code class="highlighter-rouge">tf2::Quaternion</code></a>. Based on the documentation for <a href="http://docs.ros.org/melodic/api/tf2/html/index.html" target="_blank" rel="noopener noreferrer">tf2</a> and its package listing <a href="http://wiki.ros.org/tf2" target="_blank" rel="noopener noreferrer">page</a>, answer the following questions in a text file called <code class="highlighter-rouge">deliverable_1.txt</code>:</p>
<ol>
<li><p>Assume we have an incoming <code class="highlighter-rouge">geometry_msgs::Quaternion quat_msg</code> that holds the pose of our robot. We need to save it in an already defined <code class="highlighter-rouge">tf2::Quaternion quat_tf</code> for further calculations. Write one line of C++ code to accomplish this task.</p></li>
<li><p>Assume we have just estimated our robot’s newest rotation and it’s saved in a variable called <code class="highlighter-rouge">quat_tf</code> of type <code class="highlighter-rouge">tf2::Quaternion</code>. Write one line of C++ code to convert it to a <code class="highlighter-rouge">geometry_msgs::Quaternion</code> type. Use <code class="highlighter-rouge">quat_msg</code> as the name of the new variable.</p></li>
<li><p>If you just want to know the scalar value of a <code class="highlighter-rouge">tf2::Quaternion</code>, what member function will you use?</p></li>
</ol>
<h4 class="no_toc" id="b-conversion"> <a href="#b-conversion" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <em>B</em>. Conversion</h4>
<p>The following questions will prepare you for converting between different rotation representations in C++ and ROS.</p>
<ol>
<li><p>Assume you have a <code class="highlighter-rouge">tf2::Quaternion quat_t</code>. How to extract the yaw component of the rotation with just one function call?</p></li>
<li><p>Assume you have a <code class="highlighter-rouge">geometry_msgs::Quaternion quat_msg</code>. How to you convert it to an Eigen 3-by-3 matrix? Refer to <a href="http://docs.ros.org/jade/api/tf2_eigen/html/index.html" target="_blank" rel="noopener noreferrer">this</a> and <a href="http://eigen.tuxfamily.org/dox-3.2/classEigen_1_1Quaternion.html" target="_blank" rel="noopener noreferrer">this</a> for possible functions. You probably need two function calls for this.</p></li>
</ol>
<h3 id="deliverable-2---modelling-and-control-of-uavs-20-pts"> <a href="#deliverable-2---modelling-and-control-of-uavs-20-pts" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Deliverable 2 - Modelling and control of UAVs (20 pts)</h3>
<h4 class="no_toc" id="a-structure-of-quadrotors"> <a href="#a-structure-of-quadrotors" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <em>A</em>. Structure of quadrotors</h4>
<p><img src="https://mit-spark.github.io/VNAV2020-handouts/assets/images/lab3/drone_spinning.png" alt="Two drones example" class="mx-auto d-block img-size-60"></p>
<p>The figure above depicts two quadrotors <em>(a)</em> and <em>(b)</em>. Quadrotor <em>(a)</em> is a fully functional UAV, while for Quadrotor <em>(b)</em> someone changed propellers 3 and 4 and reversed their respective rotation directions.</p>
<p>Show mathematically that quadrotor <em>(b)</em> is not able to track a trajectory defined in position $[x,y,z]$ and yaw orientation $\Psi$.</p>
<ul><li class="hint">Hint: write down the $F$ matrix (see lecture notes eq. (6.9)) for the two cases <em>(a)</em> and <em>(b)</em> and compare the rank of the two matrices</li></ul>
<h4 class="no_toc" id="b-control-of-quadrotors"> <a href="#b-control-of-quadrotors" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> <em>B</em>. Control of quadrotors</h4>
<p>Assume that empirical data suggest you can approximate the drag force (in the body frame) of a quadrotor body as:</p>
<p>\[ F^b = \begin{bmatrix} 0.1 &amp; 0 &amp; 0 \\ 0 &amp; 0.1 &amp; 0 \\ 0 &amp; 0 &amp; 0.2\end{bmatrix} (v^b)^2 \]</p>
<p>With $(v^b)^2= [-v^b_x \mid v^b_x \mid ,\, -v^b_y \mid v^b_y \mid ,\, -v^b_z \mid v^b_z \mid]^T $, and $v_x$, $v_y$, $v_z$ being the quadrotor velocities along the axes of the body frame.</p>
<p>With the controller discussed in class (see referenced paper <sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>), describe how you could use the information above to improve the tracking performance.</p>
<ul><li class="hint">Hint: the drag force introduced above is an additional term in the system’s dynamics, which the controller could compensate for explicitly…</li></ul>
<h2 id="team-1"> <a href="#team-1" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Team</h2>
<h3 id="trajectory-tracking-for-uavs"> <a href="#trajectory-tracking-for-uavs" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Trajectory tracking for UAVs</h3>
<p>In this section, we are going to implement the geometric controller discussed in class on a simulated drone.</p>
<h4 id="getting-the-codebase"> <a href="#getting-the-codebase" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Getting the codebase</h4>
<p>First, let us install some prerequisites. In a terminal, run:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>ros-melodic-mav-msgs ros-melodic-ackermann-msgs
</code></pre></div></div>
<p>Consistently with the folder structure introduced in previous assignments, we will navigate to our existing clone of the VNAV Labs repository and pull the latest updates:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># change the folder name according to your setup</span>
<span class="nb">cd</span> ~/labs
git pull
</code></pre></div></div>
<p>In <code class="highlighter-rouge">~/labs/lab_3</code> we now have the <code class="highlighter-rouge">tesse_ros_bridge</code> and the <code class="highlighter-rouge">controller_pkg</code> folders, which are both ROS packages. Let us copy these folders in our VNAV workspace and build the workspace as follows:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> <span class="nt">-r</span> ~/labs/lab_3/. ~/vnav_ws/src
<span class="nb">cd</span> ~/vnav_ws
</code></pre></div></div>
<p>In your <code class="highlighter-rouge">src</code> folder, you should see three folders: <code class="highlighter-rouge">catkin_simple</code>, <code class="highlighter-rouge">controller_pkg</code> and <code class="highlighter-rouge">tesse-ros-bridge</code>. Then, we need install some Python dependencies:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/vnav_ws/src/tesse-ros-bridge/tesse-interface
pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt  <span class="c"># Dependencies</span>
pip <span class="nb">install</span> <span class="nb">.</span>
</code></pre></div></div>
<p>At this point, you can both keep your lab 2 code or remove all the folders related to the previous labs. Either way, you need to compile the new code.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>catkin build
<span class="nb">source </span>devel/setup.bash
</code></pre></div></div>
<p>After doing so, please proceed <a href="https://drive.google.com/file/d/14LoVC9qOh-D6OlkXZd9uhdUzthpfCQh1/view?usp=sharing" target="_blank" rel="noopener noreferrer">here</a> to download the binary executable for the simulator we are going to use for lab 3. Unzip the file, put the folder in <code class="highlighter-rouge">~/vnav-builds</code>, and run the following commands:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/vnav-builds/vnav-2020-lab3/
<span class="nb">chmod</span> +x vnav-2020-lab3.x86_64
</code></pre></div></div>
<p>This will make sure you can run the executable in the command line.</p>
<h3 id="launching-the-tesse-simulator-with-ros-bridge"> <a href="#launching-the-tesse-simulator-with-ros-bridge" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Launching the TESSE simulator with ROS bridge</h3>
<p>In a terminal window, run this command to start the simulator:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/vnav-builds/vnav-2020-lab3/
./vnav-2020-lab3.x86_64
</code></pre></div></div>
<p>One the simulator starts, you should see the unity simulator (fig. below).</p>
<p><img src="https://mit-spark.github.io/VNAV2020-handouts/assets/images/lab3/sim.png" alt="Unity example" class="mx-auto d-block"></p>
<p>In the simulator, you can:</p>
<ul>
<li>press <code class="highlighter-rouge">W</code> to turn on all propellers;</li>
<li>press <code class="highlighter-rouge">R</code> to respawn the quadrotor at the initial location.</li>
</ul>
<p>Note that <strong>you can resize the window</strong> to help with debugging later on.</p>
<p>Once the workspace has been compiled successfully, with your workspace sourced execute:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># make sure to source devel/setup.bash!</span>
roslaunch tesse_ros_bridge tesse_quadrotor_bridge.launch
</code></pre></div></div>
<p>This launches two ROS nodes: <code class="highlighter-rouge">tesse_ros_brige</code> and <code class="highlighter-rouge">quadrotor_control_interface</code>. The former receives state messages from our simulator and publishes them in a few ROS topics, and the latter listens to our controller node and sends the propeller commands to our simulator. To visualize the state of our quadrotor, we will use <code class="highlighter-rouge">rviz</code>. Run the following command to load our <code class="highlighter-rouge">rviz</code> preset:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/vnav_ws/src/controller_pkg
rviz <span class="nt">-d</span> rviz/lab3.rviz
</code></pre></div></div>
<p>You should see a screen similar to this:</p>
<p><img src="https://mit-spark.github.io/VNAV2020-handouts/assets/images/lab3/rviz_starting.png" alt="rviz example" class="mx-auto d-block"></p>
<p>A few highlights:</p>
<ul>
<li>the purple upward arrow corresponds to the IMU message;</li>
<li>the <code class="highlighter-rouge">base_link_gt</code> axes correspond to the body frame of the quadrotor;</li>
<li>the <code class="highlighter-rouge">world</code> axes correspond to the world frame in ROS.</li>
</ul>
<h3 id="implement-the-controller"> <a href="#implement-the-controller" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Implement the controller</h3>
<p>From the previous section, you must have noticed that the drone is stationary. Unsurprisingly, this happens because the UAV is not receiving any control inputs. In this section, you will be precisely asked to take care of it!</p>
<p>Given four propeller speeds, the simulator propagates forward the UAV dynamics and outputs the current state of the robot. It is your job now to provide the propeller speeds based on the current state of the robot (from the simulator) and a desired one (from a trajectory generator). This problem is extensively described in the geometric controller paper <sup id="fnref:1:1"><a href="#fn:1" class="footnote">1</a></sup>, where the authors introduce an almost-globally convergent geometric controller for a quadrotor, also outlined in class. We will ask you to read the paper thoroughly and implement this controller in ROS.</p>
<p>For the purposes of this lab, the trajectory generator is given by the traj_publisher node, which outputs a time-varying desired state along a hard-coded circular trajectory. The navigation stack (almost) implemented in our codebase has the architecture shown below:</p>
<p><img src="https://mit-spark.github.io/VNAV2020-handouts/assets/images/lab3/navigation_stack.png" alt="Navigation Stack"></p>
<p>where the ROS nodes are highlighted as vertices in the graph and the ROS topic names are reported on the edges.</p>
<p>In particular:</p>
<ul>
<li>
<code class="highlighter-rouge">/desired_state</code> is of type <a href="http://docs.ros.org/melodic/api/trajectory_msgs/html/msg/MultiDOFJointTrajectoryPoint.html" target="_blank" rel="noopener noreferrer">trajectory_msgs/MultiDOFJointTrajectoryPoint</a> and has the following fields:<ul>
<li>
<code class="highlighter-rouge">transforms</code> - type <a href="http://docs.ros.org/melodic/api/geometry_msgs/html/msg/Transform.html" target="_blank" rel="noopener noreferrer">geometry_msgs/Transform[]</a>:<ul>
<li>
<code class="highlighter-rouge">translation</code>: a 3D vector with the desired position of the c.o.m. in the world frame</li>
<li>
<code class="highlighter-rouge">rotation</code>: a quaternion rapresenting a rotation (in our case will be only a yaw component)</li>
</ul>
</li>
<li>
<code class="highlighter-rouge">velocities</code> - type <a href="http://docs.ros.org/melodic/api/geometry_msgs/html/msg/Twist.html" target="_blank" rel="noopener noreferrer">geometry_msgs/Twist[]</a>:<ul>
<li>
<code class="highlighter-rouge">linear</code>: a 3D vector with the desired velocity of c.o.m. in world frame</li>
<li>
<code class="highlighter-rouge">angular</code>: we will ignore this field as it is not used by the controller</li>
</ul>
</li>
<li>
<code class="highlighter-rouge">accelerations</code> - type <a href="http://docs.ros.org/melodic/api/geometry_msgs/html/msg/Twist.html" target="_blank" rel="noopener noreferrer">geometry_msgs/Twist[]</a>:<ul>
<li>
<code class="highlighter-rouge">linear</code>: a 3d vector with the desired acceleration of c.o.m. in world frame</li>
<li>
<code class="highlighter-rouge">angular</code>: we will ignore this field as it is not used by the controller</li>
</ul>
</li>
</ul>
</li>
<li>
<code class="highlighter-rouge">/current_state</code> is of type <a href="http://docs.ros.org/melodic/api/nav_msgs/html/msg/Odometry.html" target="_blank" rel="noopener noreferrer">nav_msgs/Odometry</a> with the relevant fields:<ul>
<li>
<code class="highlighter-rouge">pose.pose</code> - type <a href="http://docs.ros.org/melodic/api/geometry_msgs/html/msg/Pose.html" target="_blank" rel="noopener noreferrer">geometry_msgs/Pose</a>:<ul>
<li>
<code class="highlighter-rouge">position</code>: a 3d vector with the current position of the c.o.m. in the world frame</li>
<li>
<code class="highlighter-rouge">orientation</code>: a quaternion representing the current orientation of the UAV</li>
</ul>
</li>
<li>
<code class="highlighter-rouge">twist.twist</code> - type <a href="http://docs.ros.org/melodic/api/geometry_msgs/html/msg/Twist.html" target="_blank" rel="noopener noreferrer">geometry_msgs/Twist</a>:<ul>
<li>
<code class="highlighter-rouge">linear</code>: a 3d vector with the current velocity of c.o.m. in the world frame</li>
<li>
<code class="highlighter-rouge">angular</code>: a 3d vector with the current angular velocity in the world frame</li>
</ul>
</li>
</ul>
</li>
<li>
<code class="highlighter-rouge">/rotor_speed_cmds</code> is of type <a href="http://docs.ros.org/melodic/api/mav_msgs/html/msg/Actuators.html" target="_blank" rel="noopener noreferrer">mav_msgs/Actuators</a> and it contains the relevant field:<ul><li>
<code class="highlighter-rouge">angular_velocities</code> - type <code class="highlighter-rouge">float64[]</code>, containing the desired speeds of the propellers.</li></ul>
</li>
</ul>
<h3 id="simulator-conventions"> <a href="#simulator-conventions" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Simulator conventions</h3>
<p>In the picture below, we illustrate the conventions used in unity simulator for the propeller speeds and their positions in the body frame. Please <strong>look carefully</strong> as this will help you build the correct wrench-to-controls matrix (<code class="highlighter-rouge">F2W</code>) in the coding assignment</p>
<p><img src="https://mit-spark.github.io/VNAV2020-handouts/assets/images/lab3/sim_convention.png" alt="Unity Simulator Convention" class="mx-auto d-block img-size-60"></p>
<p>Note that</p>
<ul>
<li>as in most research papers, we assume that, for $\omega_i &gt; 0$, all the propellers produce an upward force (lift). This is consistent with the first row of the matrix in eq. (6.9) on the lecture notes. While this might be confusing at first, note that on real quadrotors the motors are configured to rotate in different directions: two counter-clockwise (CCW), and two clockwise (CW). This configuration is necessary so that our quadrotor will be stable in its yaw direction. There are also two sets of propellers: one set for CCW motors, and another set for CW motors (both will produce upward force if mounted appropriately). See this <a href="https://www.youtube.com/watch?v=bHgeT66AXJ0" target="_blank" rel="noopener noreferrer">video</a> for an example.</li>
<li>in the figure, we show the positive spinning directions for the propellers (blue) and the resulting direction of the yaw torques generated by aerodynamic drag. For example: propeller 1’s angular velocity $\omega_1$ is considered positive when propeller 1 spins clockwise (as seen from top), which in turn produces a counter-clockwise drag torque $\tau_{\text{drag}_1}$. The sign of the drag torque is determined by applying right-hand rule: positive for counter-clockwise, and negative for clockwise.</li>
<li>the spinning directions are different from the paper and the lecture notes. The expression $\tau_{\text{drag}}^i = (-1)^i c_d\,\omega_i | \omega_i |$ implies that the drag on propeller 1 produces a negative (clockwise) yaw torque instead, for $\omega_1$. However, the above convention is acceptable: propellers are <em>mounted</em> differently in the simulated quadrotor!</li>
<li>the propeller speeds need to be provided in <strong>radians per second (rad/s)</strong>, NOT in rpm. Initially, it will be tempting to go for the latter, as it will make the drone move more easily (control inputs get bigger), however, it will hurt you in the long run.</li>
</ul>
<p>Before proceeding, keep in mind that there are a number of caveats that will make the math in your code slightly different from the one found in the paper. The main differences can be summarized as follows:</p>
<p><strong>Reference frames</strong>. The paper and your code use different conventions for coordinate frames. Please refer to the figure and pay attention to the two main facts summarized below.</p>
<p><img src="https://mit-spark.github.io/VNAV2020-handouts/assets/images/lab3/Frames-Paper-vs-ROS.png" alt="Frames Paper vs ROS" class="mx-auto d-block"></p>
<ol>
<li>In the paper, the $z$-axes - both in the world and body frames - are downwards, while ROS has them pointing upwards. This affects the signs of $b_{3_d}$ in equation (12), as well as gravity and aerodynamic forces in equations (12), (15), (16). (equation numbers refer to the paper <sup id="fnref:1:2"><a href="#fn:1" class="footnote">1</a></sup>).</li>
<li>In the paper, the $x$-body axis is along a propeller arm, while we prefer having it at 45° between two propellers. This will require some thought on your end when converting the total desired force + torques (<em>wrench</em>) into the desired propeller speeds. In other words, you have to change equation (1) from the paper. For this step, refer to equation (6.9) in the lecture notes!</li>
</ol>
<p><strong>Aerodynamic coefficients</strong>. In the paper, equation (1), the quantity $c_{\tau f}$ relates directly the yaw torque with the lift produced by a propeller. In contrast, we prefer using the <em>lift</em> and <em>drag</em> coefficients $c_f$ and $c_d$, which have a clearer physical interpretation. Consider the relation $c_{\tau f}=c_d/c_f$ between these coefficients.</p>
<h3 id="deliverable-3---geometric-controller-for-the-uav-50-pts"> <a href="#deliverable-3---geometric-controller-for-the-uav-50-pts" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Deliverable 3 - Geometric controller for the UAV (50 pts)</h3>
<p>After reading the reference <sup id="fnref:1:3"><a href="#fn:1" class="footnote">1</a></sup> - <em>thoroughly</em> - get together with your teammates and open the source file <code class="highlighter-rouge">controller_node.cpp</code>. In this file, you will find detailed instructions to fill in the missing parts and make your quadrotor fly! To have full credits for this part of the lab, your team needs to complete the following:</p>
<ul>
<li>Implement all missing parts in <code class="highlighter-rouge">controller_node.cpp</code> and ensure everything compiles.</li>
<li>Tune parameters so that the quadrotor achieves stable circular trajectory.</li>
<li>A video showing the quadrotor completing one round of the circular trajectory in <code class="highlighter-rouge">rviz</code> (can either be a screen capture, or a video shot using your phone). Please upload the video onto either Google drive or Dropbox, generate a publicly viewable link, and put the link in a text file called <code class="highlighter-rouge">rviz_drone_flight.txt</code> in your repo.</li>
</ul>
<h4 id="how-to-test"> <a href="#how-to-test" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> How to test</h4>
<p>Once you are ready to compile your code, run:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>catkin build
</code></pre></div></div>
<p>from the folder <code class="highlighter-rouge">~/vnav_ws</code>.</p>
<p>To try out your code, launch the simulator. Additionally, run your controller by typing, in a separate terminal:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch controller_pkg traj_tracking.launch 
</code></pre></div></div>
<p>Depending on your focus - and degree of luck - it will take multiple attempts to have a stable and smooth controller and multiple iterations of parameter tuning. That’s normal!</p>
<p>As a suggestion, you could start by testing a stationary waypoint, before moving to the circular trajectory. This is possible by switching the <code class="highlighter-rouge">STATIC_POSE </code> flag to <code class="highlighter-rouge">1</code> in <code class="highlighter-rouge">controller_pkg/src/traj_publisher.cpp</code>. Also, you should use <code class="highlighter-rouge">rviz</code> to visually compare the desired and the current poses.</p>
<h4 id="tuning-tips"> <a href="#tuning-tips" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> Tuning tips</h4>
<p>First of all, look closely at the equations and see what are the gain parameters directly affecting. Which one affects the yaw? Which one affects the speed? Which one affects the position? Doing so will give you a rough idea on what to do for tuning.</p>
<p>To provide a more graphical/qualitative understanding, here are some typical situations that you might encounter:</p>
<p><strong><code class="highlighter-rouge">komega</code> is too high</strong>: <img data-src="https://mit-spark.github.io/VNAV2020-handouts/assets/images/lab3/tuning_highkomega.gif" class="lazyload mx-auto d-block"></p>
<p><strong><code class="highlighter-rouge">kr</code> is too low</strong>: <img data-src="https://mit-spark.github.io/VNAV2020-handouts/assets/images/lab3/tuning_lowkr.gif" class="lazyload mx-auto d-block"></p>
<p><strong><code class="highlighter-rouge">kv</code> is too low</strong>: <img data-src="https://mit-spark.github.io/VNAV2020-handouts/assets/images/lab3/tuning_lowkv.gif" class="lazyload mx-auto d-block"></p>
<p><strong>NOTE</strong>: The specific gain parameters may differ across different computers.</p>
<h4 id="what-to-expect"> <a href="#what-to-expect" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> What to expect</h4>
<p>If your controller is working reasonably well we expect to see something like this:</p>
<p><img data-src="https://mit-spark.github.io/VNAV2020-handouts/assets/images/lab3/result.gif" class="lazyload mx-auto d-block"></p>
<p><strong>Note</strong>: it is totally fine if the drone does a rapid maneuver to start tracking the circle as soon as you run the controller node.</p>
<p>Good luck!</p>
<h1 id="references"> <a href="#references" class="anchor-heading"><svg class="d-inline-block v-align-middle" viewbox="0 0 16 16" version="1.1" width="18" height="18" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a> References</h1>
<div class="footnotes"><ol><li id="fn:1"><p>Lee, Taeyoung, Melvin Leoky, N. Harris McClamroch. “Geometric tracking control of a quadrotor UAV on SE (3).” Decision and Control (CDC), 49th IEEE Conference on. IEEE, 2010 <a href="http://math.ucsd.edu/~mleok/pdf/LeLeMc2010_quadrotor.pdf" target="_blank" rel="noopener noreferrer">Link</a> <a href="#fnref:1" class="reversefootnote">↩</a> <a href="#fnref:1:1" class="reversefootnote">↩<sup>2</sup></a> <a href="#fnref:1:2" class="reversefootnote">↩<sup>3</sup></a> <a href="#fnref:1:3" class="reversefootnote">↩<sup>4</sup></a></p></li></ol></div>
<hr>
<footer role="contentinfo"><p class="text-small text-grey-dk-000 mb-0"><a href="http://accessibility.mit.edu" target="_blank" rel="noopener noreferrer">Accessibility.</a> Copyright © 2017-2020 MIT SPARK Lab. Using <a href="https://github.com/pmarsceill/just-the-docs/tree/master" target="_blank" rel="noopener noreferrer">Just the docs</a> theme.</p></footer>
</div>
</div>
</div></div>
</div>